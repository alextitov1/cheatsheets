
# Podman/Docker OCI

## Get Help

podman --help

man podman-run # sudo mandb

## Basic commands

```sh
podman ps
podman images
podman logs <ContainerId>

podman image inspect <ImageId>
podman exec -it <ContainerId> sh

podman stop $(podman ps -aq)
podman rm $(podman ps -aq)

podman inspect --format='{{.State.Running}}' httpd

# Podman sends a SIGTERM signal to stop the container gracefully, but the application ignores the signal. After 5 seconds, Podman sends a SIGKILL signal to the container. The --time flag indicates the time that Podman waits before sending a SIGKILL signal to forcefully stop the container.
podman stop greeter --time=5



```

## Network

```sh
podman network --help
```

### Basic command

```sh
podman network create example-net
podman run -d --name my-container --net example-net container-image:latest

podman network ls
podman network inspect <NetworkId>
podman port <ContainerId>

# When you create new containers, you can connect them to multiple networks by specifying network names in a comma-separated list
podman run -d --name double-connector --net postgres-net,redis-net container-image:latest


# Alternatively, if the my-container container is already running, then run the following command to connect it to the example-net network

podman network connect example-net my-container
```

### DNS

DNS is disabled in the default podman network. To enable DNS resolution between containers, create a Podman network and connect your containers to that network.


### Port-Forwarding

```sh
podman run -p 8075:80 my-app
podman run -p 127.0.0.1:8075:80 my-app
podman port my-app
podman port --all

podman inspect my-app -f '{{.NetworkSettings.Networks.apps.IPAddress}}'
```

## Storage

### path
```sh
ls -l /home/ricardo/.local/share/containers/storage/overlay-images/
```

#### diff
display the changes made to a container's filesystem since it was started

```sh
podman diff elastic_maxwell
```

#### cp
copy files/folders between a container and the local filesystem

```sh
podman cp index.html elastic_maxwell:/var/wwww/index.html
```



## Container Registry

### RedHat registries

```sh
registry.access.redhat.com # requires no authentication
registry.redhat.io # requires authentication
```

#### useful images

```sh
registry.access.redhat.com/ubi9 # RedHat Universal Base Image
registry.access.redhat.com/ubi9/python-39 # Python 3.9 on UBI9
```

### podman registry config

podman registries config file
`/etc/containers/registries.conf`

```sh
grep ^[^#] /etc/containers/registries.conf
``` 

### podman registry operation

#### search

```sh
podman search nginx
```

#### login

```sh
podman login registry.redhat.io
```

Podman stores the credentials in the ${XDG_RUNTIME_DIR}/containers/auth.json file
```
[user@host ~]$ cat ${XDG_RUNTIME_DIR}/containers/auth.json
{
	"auths": {
		"registry.redhat.io": {
			"auth": "dXNlcjpodW50ZXIy"
		}
	}
}
[user@host ~]$ echo -n dXNlcjpodW50ZXIy | base64 -d
user:hunter2
```

### quay

Quay.io - redhat public registry

container registry - local instance
```
 registry.redhat.io/quay/quay-rhel8
```

### utility

`scopeo` is a command line utility that allows you to inspect and manage container images.

```sh
skopeo copy --dest-tls-verify=false \
  docker://${RHOCP_REGISTRY}/default/python:3.9-ubi8 \
  docker://registry.ocp4.example.com:8443/developer/python:3.9-ubi8
```


# Utility

```sh
getent hosts <hostname>

```