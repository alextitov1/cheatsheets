
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://cheat.titov.spb.ru/container/Container_images/">
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.17">
    
    
      
        <title>Container images - Cheatsheets</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.bcfcd587.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#container-images" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Cheatsheets" class="md-header__button md-logo" aria-label="Cheatsheets" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Cheatsheets
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Container images
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Cheatsheets" class="md-nav__button md-logo" aria-label="Cheatsheets" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Cheatsheets
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Content
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Content
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ansible/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ansible
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Containers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../git/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Git
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../k8s/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    K8S
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linux
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Dev
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Dev
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../C%23101/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    C#
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#basic-commands" class="md-nav__link">
    <span class="md-ellipsis">
      Basic commands
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Basic commands">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inspect" class="md-nav__link">
    <span class="md-ellipsis">
      Inspect
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#search-images-in-registry" class="md-nav__link">
    <span class="md-ellipsis">
      Search images in registry
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-image" class="md-nav__link">
    <span class="md-ellipsis">
      Build image
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#remove-all-images" class="md-nav__link">
    <span class="md-ellipsis">
      Remove all images
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#saveload-images-tofrom-tarball" class="md-nav__link">
    <span class="md-ellipsis">
      Save/load images to/from tarball
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#login-to-registry" class="md-nav__link">
    <span class="md-ellipsis">
      Login to registry
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#container-image-naming" class="md-nav__link">
    <span class="md-ellipsis">
      Container image naming
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="container-images">Container images</h1>
<h2 id="basic-commands">Basic commands</h2>
<h3 id="inspect">Inspect</h3>
<pre><code class="language-sh">podman images --format=&quot;{{.Names}}\t{{.Size}}&quot;
podman image inspect imageID
podman image tree hello-server:bad
</code></pre>
<h3 id="search-images-in-registry">Search images in registry</h3>
<pre><code class="language-sh">podman search nginx
</code></pre>
<h3 id="build-image">Build image</h3>
<pre><code class="language-sh">podman build -t localhost/my-container -f Containerfile.my-container

podman build --squash -t localhost/squashed .
podman build --squash-all -t localhost/squashed .
</code></pre>
<h3 id="remove-all-images">Remove all images</h3>
<pre><code class="language-sh">podman rmi --all
# or
podman image rm --all
</code></pre>
<p>Removes <code>dangling</code> images. (without tags and that aren't referenced by other images)</p>
<pre><code class="language-sh">podman image prune
</code></pre>
<p>With option <code>--all</code> removes all unused images</p>
<pre><code class="language-sh">podman image prune -af
</code></pre>
<h3 id="saveload-images-tofrom-tarball">Save/load images to/from tarball</h3>
<pre><code class="language-sh">podman save --output images.tar \
docker.io/library/redis \
docker.io/library/mysql

podman load --input images.tar
</code></pre>
<h3 id="login-to-registry">Login to registry</h3>
<pre><code class="language-sh">podman login registry.redhat.io
</code></pre>
<p>Podman stores the credentials in the <code>${XDG_RUNTIME_DIR}/containers/auth.json</code> file</p>
<details>
<summary>auth.json example</summary>


<pre><code>[user@host ~]$ cat ${XDG_RUNTIME_DIR}/containers/auth.json
{
    &quot;auths&quot;: {
        &quot;registry.redhat.io&quot;: {
            &quot;auth&quot;: &quot;dXNlcjpodW50ZXIy&quot;
        }
    }
}
[user@host ~]$ echo -n dXNlcjpodW50ZXIy | base64 -d
user:hunter2
</code></pre>

</details>

<h2 id="container-image-naming">Container image naming</h2>
<blockquote>
<p>[\<image repository>/\<namespace>/]\<image name>[:\<tag>]</p>
</blockquote>
<p>MAJOR.MINOR.PATCH meaning:</p>
<ul>
<li>MAJOR: backward incompatible changes</li>
<li>MINOR: backward compatible changes</li>
<li>PATCH: bug fixes</li>
</ul>
<p><a href="https://redhat-connect.gitbook.io/catalog-help/container-images/container-image-details/image-tags-and-versions">more about tags</a></p>
<h1 id="container-registry">Container Registry</h1>
<h2 id="podman-registry-config">Podman registry config</h2>
<p>podman registries config file location </p>
<pre><code class="language-sh">grep ^[^#] /etc/containers/registries.conf
</code></pre>
<h2 id="redhat-registries">RedHat registries</h2>
<pre><code class="language-sh">registry.access.redhat.com # requires no authentication
registry.redhat.io # requires authentication
registry.connect.redhat.com # requires authentication third-party products
quay.io # redhat public registry
</code></pre>
<h2 id="useful-images">Useful images</h2>
<p><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html-single/building_running_and_managing_containers/index#con_understanding-the-ubi-standard-images_assembly_types-of-container-images">RehHat UBI images</a></p>
<p>UBI - universal base images</p>
<ul>
<li>
<p><strong>Standard</strong>: This is the primary UBI, which includes DNF, systemd, and utilities such as gzip and tar.</p>
</li>
<li>
<p><strong>Init</strong>: Simplifies running multiple applications within a single container by managing them with systemd.</p>
</li>
<li>
<p><strong>Minimal</strong>: This image is smaller than the init image and still provides nice-to-have features. This image uses the microdnf minimal package manager instead of the full-sized version of DNF.</p>
</li>
<li>
<p><strong>Micro</strong>: This is the smallest available UBI because it only includes the bare minimum number of packages. For example, this image does not include a package manager.</p>
</li>
</ul>
<pre><code class="language-sh">registry.access.redhat.com/ubi9 # RedHat Universal Base Image
registry.access.redhat.com/ubi9/python-39 # Python 3.9 on UBI9
</code></pre>
<h2 id="run-your-own-registry">Run your own registry</h2>
<p>Quay container registry - container image</p>
<pre><code> podman pull registry.redhat.io/quay/quay-rhel8
</code></pre>
<p>Nexus - the artifact repository</p>
<pre><code>podman pull dockette/nexus:latest
</code></pre>
<p>Docker registry</p>
<pre><code class="language-sh"># can proxy other registries
docker run -d -p 5000:5000 --name registry docker.io/registry:latest
</code></pre>
<h1 id="build">Build</h1>
<h2 id="basic-commands_1">Basic commands</h2>
<pre><code class="language-sh">podman build -t localhost/not-squashed .

# squash CoW layers
podman build --squash -t localhost/squashed .
podman build --squash-all -t localhost/squashed .
</code></pre>
<h2 id="containerfile-instructions">Containerfile Instructions</h2>
<blockquote>
<p>Containerfiles use a small domain-specific language (DSL)</p>
</blockquote>
<ul>
<li><code>FROM</code> </li>
</ul>
<pre><code class="language-Docker">FROM registry.access.redhat.com/ubi8/ubi-minimal:latest
</code></pre>
<ul>
<li><code>ARG</code> (Defines build-time variables, typically to make a customizable container build)</li>
<li><code>ENV</code> (You can declare multiple ENV instructions within the Containerfile)</li>
</ul>
<pre><code class="language-Docker">
ARG VERSION=&quot;1.16.8&quot; BIN_DIR=/usr/local/bin/

ENV VERSION=${VERSION} \
    BIN_DIR=${BIN_DIR}

RUN curl &quot;https://dl.example.io/${VERSION}/example-linux-amd64&quot; \
        -o ${BIN_DIR}/example

</code></pre>
<ul>
<li><code>WORKDIR</code> (Sets the working directory for subsequent instructions)</li>
</ul>
<pre><code class="language-Docker">WORKDIR /opt/app-root/src
</code></pre>
<ul>
<li><code>COPY</code> and <code>ADD</code></li>
</ul>
<pre><code class="language-Docker">COPY --chown=1001:0 app.js /opt/app-root/src/
ADD https://example-linux-amd64 /usr/local/bin/example

# The ADD instruction adds the following functionality: 
# * Copying files from URLs.
# * Unpacking tar archives in the destination image.
# Because the ADD instruction adds functionality that might not be obvious, developers tend to prefer the COPY instruction for copying local files into the container image.
</code></pre>
<ul>
<li><code>RUN</code> (Executes a command and creates a new layer)</li>
</ul>
<pre><code class="language-Docker">RUN yum install -y httpd
</code></pre>
<ul>
<li><code>USER</code> (Instructions that follow the USER instruction run as this user, including the CMD instruction.)</li>
</ul>
<pre><code class="language-Docker">USER 1001
</code></pre>
<ul>
<li><code>LABEL</code> (Adds a key-value pair to the metadata of the image for organization and image selection)</li>
</ul>
<pre><code class="language-Docker">LABEL name=&quot;example&quot; \
      version=&quot;1.0&quot; \
      release=&quot;1&quot; \
      summary=&quot;Example application&quot; \
      description=&quot;Example application for demonstrating Containerfiles&quot;
</code></pre>
<ul>
<li><code>EXPOSE</code> (This instruction does not bind the port on the host and is for documentation purposes)</li>
</ul>
<pre><code class="language-Docker">EXPOSE 8080
</code></pre>
<ul>
<li><code>VOLUME</code> (A data volume is a specially-designated directory within one or more containers that bypasses the Union File System.)</li>
</ul>
<pre><code class="language-Docker">VOLUME /var/lib/mysql
</code></pre>
<ul>
<li><code>ENTRYPOINT</code> (Sets the executable to run when the container is started) </li>
</ul>
<pre><code class="language-Docker">ENTRYPOINT [&quot;executable&quot;, &quot;param1&quot;, ... &quot;paramN&quot;]
</code></pre>
<ul>
<li><code>CMD</code> (Runs a command when the container is started. This command is passed to the executable defined by ENTRYPOINT. Base images define a default ENTRYPOINT, which is usually a shell executable, such as Bash.)</li>
</ul>
<pre><code class="language-Docker">CMD [&quot;echo&quot;, &quot;Hello&quot;, &quot;Red Hat&quot;]
</code></pre>
<blockquote>
<p>Neither ENTRYPOINT nor CMD run when building a container image. Podman executes them when you start a container from the image.</p>
</blockquote>
<h2 id="multistage-builds">Multistage Builds</h2>
<pre><code class="language-Docker"># First stage
FROM registry.access.redhat.com/ubi8/nodejs-14:1 as builder
COPY ./ /opt/app-root/src/
RUN npm install
RUN npm run build

# Second stage
FROM registry.access.redhat.com/ubi8/nginx-120
COPY --from=builder /opt/app-root/src/ /usr/share/nginx/html
</code></pre>
<h1 id="utility">Utility</h1>
<p><code>scopeo</code> is a command line utility that allows you to inspect and manage container images.</p>
<pre><code class="language-sh">skopeo copy --dest-tls-verify=false \
  docker://${RHOCP_REGISTRY}/default/python:3.9-ubi8 \
  docker://registry.ocp4.example.com:8443/developer/python:3.9-ubi8
</code></pre>
<p>buildah - build container images from Dockerfiles</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.1e8ae164.min.js"></script>
      
        <script src="../../search/main.js"></script>
      
    
  </body>
</html>