# Resolving ISCSI Issues

iSCSI - Internet Small Computer System Interface is a protocol that allows SCSI commands to be sent over a network. An alternative to Fibre Channel.

![iSCSI block storage](./pic/block_storage_scsi_topologies.svg)

* **initiator** - client that initiates the iSCSI connection.
* **target** - server that provides the iSCSI storage.
* **IQN** - iSCSI Qualified Name, a unique identifier for iSCSI devices.
* **LUN** - Logical Unit Number, a unique identifier for a logical unit.
* **ACL** - Access Control List, a list of initiators that are allowed to connect to a target.
* **portal** - IP address and port number of the target.
* **TPG** - Target Portal Group, a group of portals that are associated with a target.

## Configuring iSCSI Initiator

iSCSI initiator can be software or hardware-based.

Configuring the sortwar iSCSI initiator requires installing the `iscsi-initiator-utils` package. This package includes the `iscsi` and `iscsid` services, and the `/etc/iscsi/iscsid.conf` and `/etc/iscsi/initiatorname.iscsi` configuration files.

iSCSI initiator requires a unique iSCSI Qualified Name (IQN).

The `/etc/iscsi/iscsid.conf` file contains the default settings for iSCSI targets.

## Connecting to iSCSI Targets

The iscsiadm utility, provided by the `iscsi-initiator-utils` package, is used to discover, log in to, and list targets.

```sh
# Discover iSCSI targets
iscsiadm -m discovery -t st -p server.lab.example.com:3260
> 172.25.250.X:3260,1 iqn.2021-10.com.example.lab:target1
```

```sh
# Log in to an iSCSI target
iscsiadm -m node -T iqn.2021-10.com.example.lab:target1 -l
```

```sh
# List iSCSI targets
iscsiadm -m node
> 172.25.250.X:3260,1 iqn.2021-10.com.example.lab:target1
```

When logged in to a target, the device appears locally on the client.

```sh
grep "Attached SCSI" /var/log/messages
```

During the discovery process, iscsiadm stores target information and settings in the `/var/lib/iscsi/nodes` directory.

## Authentication Options

iSCSI uses ACLs to control which targets and LUNs initiators can access.
Use Challenge-Handshake Authentication Protocol (CHAP) to authenticate to force to provide a username and password before accessing LUNs.
By default, CHAP is disabled.

```ini
# /etc/iscsi/iscsid.conf

# Enable CHAP Authentication
node.session.auth.authmethod = CHAP

# One-way authentication:
node.session.auth.username = <username>
node.session.auth.password = <password>

# Add for two-way authentication:
node.session.auth.username_in = <username>
node.session.auth.password_in = <password>
```
